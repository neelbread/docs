---
title: "Iterative (Sequential) Baking"
description: "Refine and improve already-baked models with additional training"
---

Iterative baking allows you to refine already-baked models by using them as the base for additional baking. Improve specific behaviors, add new capabilities, or fix issues without starting from scratch.

<Note>
Iterative baking builds on [single-prompt](/guides/single-prompt-bake) and [multi-target](/guides/multi-target-baking) baking. Complete those first.
</Note>

## Why Iterative Baking?

**Use iterative baking to:**
- **Refine behavior** - Fix issues or improve specific responses
- **Add capabilities** - Layer new skills onto existing knowledge
- **Specialize further** - Make an expert model even more expert
- **A/B test variations** - Create model versions to compare

**Think of it as:** Yoda v1 → Yoda v2 → Yoda v3

---

## How It Works

### Standard Baking
```
Base Model → Bake (Yoda prompt) → Yoda Model v1
```

### Iterative Baking
```
Base Model → Bake (Yoda prompt) → Yoda v1 → Bake (more wisdom) → Yoda v2
```

The key: Use your baked model as the `base_model` for the next bake.

---

## Example: Refining Yoda

### Scenario
Your Yoda model (v1) works well but needs improvement:
- Sometimes too verbose (want more cryptic responses)
- Missing some Force-specific wisdom
- Could be calmer in certain situations

Solution: Bake Yoda v1 with refined training data → Yoda v2

---

## Complete Iterative Workflow

<Steps>
  <Step title="Identify Your Base Model">
    Use your previously baked model as the starting point:
    
    ```python
    import os
    from aibread import Bread
    
    client = Bread(api_key=os.environ.get("BREAD_API_KEY"))
    
    # Your baked model from previous training
    base_model = "path/to/yoda_v1_model"  # Or HuggingFace repo
    ```
    
    <Info>
    You can use any baked model: one you trained, a teammate's model, or even a public baked model from HuggingFace.
    </Info>
  </Step>

  <Step title="Create Refinement Prompts">
    Define prompts that address specific improvements:
    
    ```python
    client.repo.set(repo_name="yoda_v2")
    
    # Teacher: More specific, refined guidance
    client.prompts.set(
        prompt_name="yoda_refined_teacher",
        repo_name="yoda_v2",
        messages=[{
            "role": "system",
            "content": """You are Yoda at peak wisdom. 
            - Speak in 1-2 short sentences maximum
            - Use inverted syntax consistently
            - Reference the Force in mystical, cryptic ways
            - Maintain absolute calm even when provoked"""
        }]
    )
    
    # Student: Still empty for always-on behavior
    client.prompts.set(
        prompt_name="empty_student",
        repo_name="yoda_v2",
        messages=[{"role": "system", "content": ""}]
    )
    ```
    
    <Tip>
    Focus your refinement prompt on SPECIFIC changes. Don't repeat everything from v1, just what needs improvement.
    </Tip>
  </Step>

  <Step title="Generate Targeted Training Data">
    Create training examples that target your improvements:
    
    ```python
    # Focus on scenarios where v1 struggled
    client.targets.set(
        target_name="yoda_refinement",
        repo_name="yoda_v2",
        template="default",
        overrides={
            "generators": [{
                "type": "hardcoded",
                "numq": 3,
                "questions": [
                    "Explain the Force in detail",  # Was too verbose
                    "You're wrong about the dark side!",  # Test calmness
                    "Why should I trust you?"  # Needs mystical response
                ]
            }],
            "model_name": base_model,  # Use Yoda v1 as base
            "u": "yoda_refined_teacher",
            "v": "empty_student"
        }
    )
    
    # Generate training data
    client.targets.stim.run("yoda_refinement", "yoda_v2")
    client.targets.rollout.run("yoda_refinement", "yoda_v2")
    ```
    
    <Warning>
    Use your baked model (`base_model`) here, not the original base model. This ensures refinement builds on existing behavior.
    </Warning>
  </Step>

  <Step title="Bake Refinement on Top">
    Train the refinement on your baked model:
    
    ```python
    bake = client.bakes.set(
        bake_name="yoda_v2_refinement",
        repo_name="yoda_v2",
        template="default",
        overrides={
            "datasets": [
                {"target": "yoda_refinement", "weight": 1.0}
            ],
            "model": {
                "type": "bake",
                "name_or_path": base_model,  # Start from Yoda v1
                "baked_adapter_config": {
                    "r": 8,
                    "lora_alpha": 16
                }
            },
            "epochs": 2,  # Fewer epochs for refinement
            "micro_batch_size": 1
        }
    )
    
    client.bakes.run("yoda_v2_refinement", "yoda_v2")
    ```
    
    <Success>
    Yoda v2 training started! This refines v1's behavior without forgetting what it already learned.
    </Success>
  </Step>
</Steps>

---

## Iterative Baking Strategies

### 1. Incremental Refinement
Make small, focused improvements over multiple iterations.

```python
v1 → Add calmness     → v2
v2 → Add mysticism    → v3  
v3 → Reduce verbosity → v4
```

### 2. A/B Testing Variations
Create multiple versions with different refinements:

```python
v1 → Refinement A → v2a (more cryptic)
v1 → Refinement B → v2b (more direct)
```

Test both versions to see which performs better.

### 3. Domain Expansion
Add new capabilities while preserving core behavior:

```python
Yoda v1 (general wisdom) → Add Force training expertise → Yoda v2
```

### 4. Error Correction
Fix specific problematic responses:

```python
v1 (sometimes rude) → Refinement on politeness → v2 (always respectful)
```

---

## Key Differences vs. Initial Baking

| Aspect | Initial Baking | Iterative Baking |
|--------|----------------|------------------|
| **Base model** | Pretrained (e.g., Qwen) | Your baked model |
| **Training data** | Comprehensive coverage | Focused on improvements |
| **Epochs** | 3-5 | 1-2 (lighter touch) |
| **Learning rate** | Standard (0.0001) | Often lower (0.00005) |
| **Goal** | Establish behavior | Refine behavior |

---

## Multi-Target Iterative Baking

Refine a model by adding multiple refinement targets:

```python
# Start with general Yoda v1
base = "yoda_v1"

# Refine with multiple aspects
targets = [
    {
        "name": "conciseness_refinement",
        "weight": 0.4,
        "focus": "Shorter responses"
    },
    {
        "name": "mysticism_refinement", 
        "weight": 0.3,
        "focus": "More Force references"
    },
    {
        "name": "calmness_refinement",
        "weight": 0.3,
        "focus": "Never agitated"
    }
]

# All targets use yoda_v1 as base
# Combined bake creates refined yoda_v2
```

---

## Best Practices

<AccordionGroup>
  <Accordion title="Use Fewer Epochs" icon="gauge-simple">
    Refinements need 1-2 epochs, not 3-5. You're adjusting, not retraining from scratch.
  </Accordion>

  <Accordion title="Lower Learning Rates" icon="chart-line-down">
    Use 50% of initial learning rate (e.g., 0.00005 instead of 0.0001) to avoid catastrophic forgetting.
  </Accordion>

  <Accordion title="Target Specific Issues" icon="crosshairs">
    Generate training data focused on what needs improvement, not everything the model does.
  </Accordion>

  <Accordion title="Keep Version History" icon="clock-rotate-left">
    Save each version (v1, v2, v3) so you can revert if a refinement doesn't work.
  </Accordion>

  <Accordion title="Test Between Iterations" icon="vial">
    Validate v1 before creating v2. Ensure you're refining a solid base.
  </Accordion>

  <Accordion title="Small Changes" icon="sliders">
    Make incremental improvements. Easier to debug and less risk of breaking existing behavior.
  </Accordion>
</AccordionGroup>

---

## When NOT to Use Iterative Baking

**Don't use iterative baking if:**
- ❌ Your base model has major flaws - start fresh instead
- ❌ You want completely different behavior - bake from pretrained model
- ❌ You're testing a new prompt - start with new base for clean comparison

**Do use iterative baking when:**
- ✅ Base model is good but needs polish
- ✅ Adding complementary skills to existing behavior
- ✅ Fixing specific edge cases

---

## Complete Example: Three Iterations

```python
import os
from aibread import Bread

client = Bread(api_key=os.environ.get("BREAD_API_KEY"))

# Iteration 1: Initial Yoda
# [Run full single-prompt bake workflow]
# Result: yoda_v1

# Iteration 2: Add conciseness
client.repo.set(repo_name="yoda_v2")
# [Create refinement target focused on brevity]
# Use yoda_v1 as base model
# Result: yoda_v2 (brief + Yoda)

# Iteration 3: Add mysticism
client.repo.set(repo_name="yoda_v3")
# [Create refinement target focused on Force wisdom]
# Use yoda_v2 as base model
# Result: yoda_v3 (brief + Yoda + mystical)
```

---

## Next Steps

<CardGroup cols={2}>
  <Card
    title="Production Patterns"
    icon="shield"
    href="/guides/production-patterns"
  >
    Add monitoring to track model improvements
  </Card>
  <Card
    title="Bake Configuration"
    icon="gear"
    href="/configuration/bake-config"
  >
    Fine-tune hyperparameters for refinement
  </Card>
  <Card
    title="Multi-Target Baking"
    icon="layer-group"
    href="/guides/multi-target-baking"
  >
    Combine multiple refinements in one bake
  </Card>
  <Card
    title="Generators"
    icon="wand-sparkles"
    href="/configuration/generators"
  >
    Generate focused training data for refinements
  </Card>
</CardGroup>

